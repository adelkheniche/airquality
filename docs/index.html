<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atelier Céramique – Niveau de particules</title>
  <link rel="icon" href="favicon-96X96.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap"
    rel="stylesheet"
  />
  
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary:'#424341',
            'primary-hover':'#2F3030',
            text:'#424341',
            secondary:'#545858',
            border:'#AAAFAF',
            success:'#424341',
            warning:'#AAAFAF',
            danger:'#5E5862'
          },
          borderRadius: { 'xl2': '1rem', 'xl3': '1.25rem' }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body class="min-h-screen">

  <!-- Header -->
  <header class="layout-container py-6 flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
    <div class="brand flex items-center gap-5">
      <div class="brand-mark" aria-hidden="true">
        <svg class="brand-icon" viewBox="0 0 64 64" role="img" focusable="false">
          <path d="M18 46 L29 18 L40 46" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M23.5 33.5H33.5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
          <path d="M40.5 22c6.6 0 11.5 4.9 11.5 11.5S47.1 45 40.5 45c-4.9 0-8.7-2.6-10.9-6.5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M45.5 38.2l6.3 6.5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M35.2 26.2c3.5-3.1 9.4-3.3 12.9-0.3" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity="0.75" />
        </svg>
      </div>
      <div class="brand-copy">
        <h1 class="brand-title text-balance">Atelier Céramique</h1>
        <p class="brand-subtitle">Niveau de particules</p>
      </div>
    </div>

  </header>

  <main class="layout-container pb-16 space-y-10">

    <!-- KPIs (placeholder simples, on garde la logique en place) -->
    <section class="grid gap-6 md:grid-cols-12">
      <div class="card kpi-card md:col-span-4">
        <div class="kpi-header">
          <p class="kpi-label">Pics détectés</p>
          <span class="kpi-icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 16.5L9.5 11L13 14.5L20 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20 12V7H15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        </div>
        <div class="kpi-metric">
          <div class="kpi-value-wrap">
            <span id="kpi-peaks" class="kpi-value tabular-nums">–</span>
          </div>
        </div>
        <p class="kpi-sub">Total sur la période</p>
      </div>

      <div class="card kpi-card md:col-span-4">
        <div class="kpi-header">
          <p class="kpi-label">PM₂.₅ actuel</p>
          <span class="kpi-icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 16.5a7 7 0 1 1 14 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M12 12l3-4.2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="12" cy="12" r="1.25" fill="currentColor"/>
            </svg>
          </span>
        </div>
        <div class="kpi-metric">
          <div class="kpi-value-wrap">
            <span id="kpi-last" class="kpi-value tabular-nums">–</span>
            <span class="kpi-unit">µg/m³</span>
          </div>
          <span id="kpi-last-arrow" class="kpi-trend-icon" aria-hidden="true"></span>
        </div>
        <p id="kpi-last-time" class="kpi-sub">–</p>
      </div>

      <div class="card kpi-card md:col-span-4">
        <div class="kpi-header">
          <p class="kpi-label">Temps au-dessus du seuil</p>
          <span class="kpi-icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 19H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M7 16L11.5 7.5L14.5 13L17 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        </div>
        <div class="kpi-metric">
          <div class="kpi-value-wrap">
            <span id="kpi-pct" class="kpi-value tabular-nums">–</span>
          </div>
          <span id="kpi-pct-pill" class="status-pill">—</span>
        </div>
        <p class="kpi-sub">Part au-dessus du seuil OMS</p>
      </div>
    </section>

    <!-- Trend (single chart with range buttons) -->
    <section class="card">
      <div class="section-header">
        <h2 id="chart-title" class="section-title">Aujourd’hui (24 h)</h2>
        <div class="summary-pills" id="chart-summary"></div>
      </div>
      <div id="chart-main" class="h-72"></div>
      <div class="button-bar">
        <button class="tw-btn tw-btn-primary" data-range="24h">24 h</button>
        <button class="tw-btn tw-btn-outline" data-range="7d">7 jours</button>
        <button class="tw-btn tw-btn-outline" data-range="30d">30 jours</button>
        <button class="tw-btn tw-btn-outline" data-range="all">Depuis le début</button>
      </div>
    </section>

    <!-- Table + Pics (structure légère) -->
    <section class="grid gap-6 lg:grid-cols-12">
      <div class="card overflow-hidden lg:col-span-7">
        <h3 class="section-title mb-4">Activités → Risque</h3>
        <div class="table-scroll">
          <table class="data-table">
            <thead>
              <tr>
                <th class="text-left">Hashtag</th>
                <th class="text-right">Heures</th>
                <th class="text-right">Pics</th>
                <th class="text-right">Pics/h</th>
              </tr>
            </thead>
            <tbody id="tbl-acts"></tbody>
          </table>
        </div>
      </div>

      <div class="card lg:col-span-5">
        <h3 class="section-title mb-4">Pics détectés</h3>
        <ul id="list-peaks" class="stacked-list"></ul>
      </div>
    </section>
  </main>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/utc.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/timezone.js"></script>
  <script>
    dayjs.extend(dayjs_plugin_utc);
    dayjs.extend(dayjs_plugin_timezone);
    dayjs.tz.setDefault('Europe/Paris');
    function fmtTs(tsISOorEpoch) {
      const d = typeof tsISOorEpoch === 'number'
        ? dayjs.unix(tsISOorEpoch).tz('Europe/Paris')
        : dayjs(tsISOorEpoch).tz('Europe/Paris');
      return d.format('DD/MM/YYYY HH:mm');
    }
  </script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

  <!-- Config + App -->
  <script src="config.js"></script>
  <script src="main.js"></script>
</body>
</html>
