<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Atelier Céramique – Niveau de particules</title>
  <link rel="icon" href="favicon-96X96.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..72,400..800&family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary:'#DF2935',
            'primary-hover':'#C2202C',
            'primary-active':'#A61A23',
            text:'#080708',
            secondary:'#811EEB',
            caption:'#4C2BB7',
            border:'#D9E0EE',
            background:'#F5F7FA',
            surface:'#EEF1F8',
            panel:'#FFFFFF',
            success:'#138A5B',
            warning:'#FDCA40',
            danger:'#DF2935'
          },
          borderRadius: { 'xl2': '1rem', 'xl3': '1.25rem' }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body class="app-body">

  <div class="app-shell">

    <header class="app-bar" role="banner">
      <div class="app-container app-bar__inner">
        <div class="app-bar__titles">
          <p class="app-bar__subtitle">Niveau de particules</p>
          <h1 class="app-bar__title">Atelier Céramique</h1>
        </div>
        <button class="icon-button" type="button" aria-label="Paramètres">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19.4 15.5a1.27 1.27 0 0 0 1.14-.72 9.16 9.16 0 0 0 0-5.56 1.27 1.27 0 0 0-1.14-.72 1.24 1.24 0 0 1-1.16-.84 1.26 1.26 0 0 1 .31-1.32 8.79 8.79 0 0 0-3.93-2.27 1.24 1.24 0 0 1-1-.95 1.26 1.26 0 0 0-1.24-1h-1.36a1.26 1.26 0 0 0-1.24 1 1.24 1.24 0 0 1-1 .95 8.79 8.79 0 0 0-3.93 2.27 1.26 1.26 0 0 1 .31 1.32 1.24 1.24 0 0 1-1.16.84 1.27 1.27 0 0 0-1.14.72 9.16 9.16 0 0 0 0 5.56 1.27 1.27 0 0 0 1.14.72 1.24 1.24 0 0 1 1.16.84 1.26 1.26 0 0 1-.31 1.32 8.79 8.79 0 0 0 3.93 2.27 1.24 1.24 0 0 1 1 .95 1.26 1.26 0 0 0 1.24 1h1.36a1.26 1.26 0 0 0 1.24-1 1.24 1.24 0 0 1 1-.95 8.79 8.79 0 0 0 3.93-2.27 1.26 1.26 0 0 1-.31-1.32 1.24 1.24 0 0 1 1.16-.84Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </header>

    <main id="contenu-principal" class="app-main">
      <div class="app-container app-stack">

        <section class="section-block" id="section-apercu">
          <article class="card card--highlight" aria-live="polite">
            <div class="card-overline">
              <p class="overline">PM2.5 actuel</p>
              <span id="kpi-last-chip" class="status-chip">—</span>
            </div>
            <div class="current-value">
              <div class="current-value__group">
                <span id="kpi-last" class="current-value__value tabular-nums">–</span>
                <span class="current-value__unit">µg/m³</span>
              </div>
              <span id="kpi-last-arrow" class="current-value__trend" aria-hidden="true"></span>
            </div>
            <p id="kpi-last-time" class="card-caption">–</p>
          </article>

          <div class="stat-pills" aria-live="polite" aria-label="Indicateurs principaux">
            <div class="stat-pill" data-stat="peaks">
              <p class="stat-pill__label">Pics détectés</p>
              <span id="kpi-peaks" class="stat-pill__value tabular-nums">–</span>
              <p class="stat-pill__caption">Total sur la période</p>
            </div>
            <div class="stat-pill" data-stat="pct">
              <p class="stat-pill__label">Temps au-dessus du seuil</p>
              <div class="stat-pill__value-group">
                <span id="kpi-pct" class="stat-pill__value tabular-nums">–</span>
                <span id="kpi-pct-pill" class="stat-pill__badge">—</span>
              </div>
              <p class="stat-pill__caption">Part au-dessus du seuil OMS</p>
            </div>
          </div>
        </section>

        <section class="section-block" id="section-historique" aria-labelledby="chart-title">
          <article class="card chart-card">
            <div class="section-header">
              <h2 id="chart-title" class="section-title">Aujourd’hui (24 h)</h2>
              <div class="summary-pills" id="chart-summary"></div>
            </div>
            <div id="chart-main" class="chart-area" aria-live="polite"></div>
          </article>
        </section>

        <section class="section-block" id="section-activites" aria-label="Activités et pics détectés">
          <article class="card">
            <h2 class="section-title">Activités → Risque</h2>
            <div id="cell-activite"></div>
          </article>

          <article class="card">
            <h2 class="section-title">Pics détectés</h2>
            <ul id="list-peaks" class="stacked-list"></ul>
          </article>
        </section>

      </div>
    </main>

    <nav class="range-bar" aria-label="Filtrer la période">
      <div class="app-container range-bar__inner">
        <button class="range-pill tw-btn tw-btn-primary" data-range="24h" type="button">24 h</button>
        <button class="range-pill tw-btn tw-btn-outline" data-range="7j" type="button">7 jours</button>
        <button class="range-pill tw-btn tw-btn-outline" data-range="30j" type="button">30 jours</button>
        <button class="range-pill tw-btn tw-btn-outline" data-range="debut" type="button">Depuis le début</button>
      </div>
    </nav>

  </div>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/utc.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/timezone.js"></script>
  <script>
    dayjs.extend(dayjs_plugin_utc);
    dayjs.extend(dayjs_plugin_timezone);
    dayjs.tz.setDefault('Europe/Paris');
    function fmtTs(tsISOorEpoch) {
      const d = typeof tsISOorEpoch === 'number'
        ? dayjs.unix(tsISOorEpoch).tz('Europe/Paris')
        : dayjs(tsISOorEpoch).tz('Europe/Paris');
      return d.format('DD/MM/YYYY HH:mm');
    }
  </script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

  <!-- Config + App -->
  <script src="config.js"></script>
  <script src="main.js"></script>
</body>
</html>
